# Google Apps Script Project: 1Ukzd26N4sR2e_S_ZmBB2Z_dEIYXzuT8JkZu6DUNnHt53v-PSIG_9HB8k

## Project Overview
This Google Apps Script project is a web application designed to demonstrate and facilitate the OAuth2 authorization flow for Google APIs. Its primary purpose is to guide a user through the authorization process to obtain access and refresh tokens, which can then be used to interact with Google services.

## Functionality

### `Code.js`
This is the main script file containing the core logic for the OAuth2 authorization flow.
-   **`client_id` and `client_secret`**: Global constants storing the OAuth2 client credentials. These are sensitive and should ideally be stored more securely (e.g., in `PropertiesService`).
-   **`myFunction()`**: A placeholder function that attempts to fetch data from the Cloud Resource Manager API. It's likely used for testing API access after authorization.
-   **`getAuthorizationUrl()`**: Constructs the full Google OAuth2 authorization URL. This URL is used to redirect the user to Google's authorization server. It includes parameters such as `client_id`, `redirect_uri`, `scope` (specifically `https://www.googleapis.com/auth/cloud-platform`), `response_type` (`code`), and `access_type` (`offline` to obtain a refresh token). It utilizes `ScriptApp.newStateToken()` to manage the OAuth state.
-   **`receiveAuthorizationCode(e)`**: This function acts as the callback endpoint for Google's authorization server. After a user grants permission, Google redirects to this function with an authorization `code`. The function extracts this `code` from the event parameters (`e`), stores it in `CacheService.getUserCache()`, and then calls `exchangeAuthorizationCodeForRefreshAndAccessTokens()` to complete the token exchange. Finally, it serves the `index.html` template.
-   **`exchangeAuthorizationCodeForRefreshAndAccessTokens()`**: Makes a POST request to Google's OAuth2 token endpoint (`https://oauth2.googleapis.com/token`). It sends the authorization `code` (retrieved from `CacheService`), `client_id`, `client_secret`, and `redirect_uri` to exchange for `access_token` and `refresh_token`. These tokens are then stored in `CacheService.getUserCache()`.
-   **`receiveRefreshAndAccessTokens(e)`**: A callback function intended for debugging the token exchange process. It simply returns the event parameters (`e`) as JSON content.
-   **`getToken()`**: A function that appears to be an incomplete or incorrect attempt to obtain a token. Its current implementation makes a POST request to the authorization URL without a proper payload for token exchange.
-   **`doGet()`**: The entry point for web app requests. It serves the `index.html` template.

### `buildAuthorizationUrl.js`
-   **`myFunction()`**: This file contains an empty `myFunction()`, suggesting it might be a placeholder, an unused script file, or intended for future development.

## Web Interface (`index.html`)
The `index.html` file provides a simple user interface for initiating the OAuth2 flow and displaying the obtained tokens.
-   **Authorization URL Link**: A clickable link labeled "authorization URL" that, when clicked, redirects the user to Google's authorization page. The URL is dynamically generated by the server-side `getAuthorizationUrl()` function.
-   **Token Display**: Read-only input fields are provided to display the `Authorization Code`, `Access Token`, and `Refresh Token`. These values are retrieved from `CacheService.getUserCache()` and injected into the HTML using server-side templating (`<?= ... ?>`).
-   **Styling**: The interface uses `mini.css` for basic, minimalist styling.

## Permissions
The `appsscript.json` manifest specifies the following web app execution permissions:
-   `webapp.access`: `MYSELF` - This means the web application can only be accessed by the user who deployed it.
-   `webapp.executeAs`: `USER_DEPLOYING` - The script will execute with the identity and permissions of the user who deployed the web app.

The project requires the following OAuth scopes (though not explicitly listed in `appsscript.json` for this project, they are implied by the functionality):
-   `https://www.googleapis.com/auth/cloud-platform`: Required for accessing Google Cloud Platform resources, as indicated by the `scope` in `getAuthorizationUrl()`.
-   `https://www.googleapis.com/auth/script.external_request`: Required for `UrlFetchApp.fetch()` calls to external endpoints like Google's OAuth2 token endpoint.

## Configuration
This project uses hardcoded `client_id` and `client_secret` values directly in `Code.js`. For production environments, these sensitive credentials should be stored securely using `PropertiesService` or `Secret Manager`.

## Deployments
The project has two deployments:

1.  **Deployment 1 (HEAD)**:
    -   **ID**: `AKfycbwg4MSFGK8FStH1L6IqAPgFfaYY_v3J3dOe1WkkRwc`
    -   **Target**: `HEAD` (This deployment points to the latest saved version of the script).
    -   **Description**: (No specific description provided).
    -   **Published URL**: `https://script.google.com/macros/s/AKfycbwg4MSFGK8FStH1L6IqAPgFfaYY_v3J3dOe1WkkRwc/exec`

2.  **Deployment 2 (Version 14)**:
    -   **ID**: `AKfycbzapKCD4fac6szWRM2UquJ0hsiaQWrQ6FXPzHozx5CtNqqp_H5pUZAQsKBSiYZkEis`
    -   **Target**: `14`
    -   **Description**: "testing authorization URL"
    -   **Published URL**: `https://script.google.com/macros/s/AKfycbzapKCD4fac6szWRM2UquJ0hsiaQWrQ6FXPzHozx5CtNqqp_H5pUZAQsKBSiYZkEis/exec`
