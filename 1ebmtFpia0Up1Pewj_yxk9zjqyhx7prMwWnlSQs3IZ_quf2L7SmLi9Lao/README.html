<!DOCTYPE html>
<html lang="ja">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Tasks Manager - Documentation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; color: #333; font-family: 'Segoe UI', sans-serif; line-height: 1.6; }
    .container { max-width: 800px; margin: 40px auto; background: #fff; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    h1 { color: #0d6efd; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 30px; }
    h2 { margin-top: 40px; margin-bottom: 20px; color: #495057; border-left: 5px solid #0d6efd; padding-left: 15px; }
    h3 { margin-top: 30px; margin-bottom: 15px; color: #6c757d; font-size: 1.25rem; font-weight: 600; }
    code { background-color: #f1f3f5; padding: 2px 6px; border-radius: 4px; color: #d63384; font-size: 0.9em; }
    pre { background-color: #212529; color: #f8f9fa; padding: 15px; border-radius: 6px; overflow-x: auto; }
    pre code { background-color: transparent; color: inherit; padding: 0; }
    .badge-custom { font-size: 0.9em; margin-right: 5px; }
    ul { padding-left: 20px; }
    li { margin-bottom: 8px; }
    .alert-info { border-left: 5px solid #0dcaf0; }
  </style>
</head>
<body>

<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div class="text-muted small">v2.0</div>
    <a href="<?= ScriptApp.getService().getUrl() ?>" class="btn btn-outline-primary btn-sm">
      <i class="bi bi-arrow-left"></i> アプリに戻る
    </a>
  </div>

  <h1>Google Tasks Manager <small class="text-muted fs-5">(GAS Edition)</small></h1>

  <p class="lead">
    Google Apps Script (GAS) 上で動作する、Google Tasks の高度な管理用ウェブアプリケーションです。<br>
    標準UIでは難しい「リスト間のタスク移動」や「一括整理」を効率化し、<strong>Inbox Zero</strong> の実践を強力にサポートします。
  </p>

  <h2>🚀 主な機能</h2>

  <h3>1. タスクリストのダッシュボード表示</h3>
  <ul>
    <li><strong>統計情報の可視化</strong>: 「未完了」「完了」「削除済み」タスク数および最終更新日を表示。</li>
    <li><strong>プレビュー機能</strong>: リストカード上のバッジにマウスオーバーで、最新タスク5件をポップアップ表示。</li>
    <li><strong>デフォルトリスト識別</strong>: システム既定のリスト（Inbox）を自動識別し、青枠で強調表示。</li>
  </ul>

  <h3>2. 高度なタスク操作</h3>
  <ul>
    <li><strong>リスト間移動 (Move)</strong>: 選択したタスクを別のリストへコピー＆削除で移動。</li>
    <li><strong>⚡ Quick Action</strong>: 現在のリストにある「全ての未完了タスク」を、ワンクリックで既定リスト（Inbox）へ一括退避。</li>
    <li><strong>一括削除</strong>: 不要なタスクをまとめて削除。</li>
    <li><strong>安全性</strong>: 削除済みタスクは操作対象外としてロックし、誤操作を防止。</li>
  </ul>

  <h3>3. リスト管理</h3>
  <ul>
    <li><strong>リストの削除</strong>: 不要になったタスクリスト自体を削除（デフォルトリストは保護されます）。</li>
  </ul>

  <h2>🛠 技術アーキテクチャ</h2>

  <h3>バックエンド (Google Apps Script)</h3>
  <ul>
    <li><strong>Google Tasks API v1</strong>: データの取得・操作。</li>
    <li><strong>CacheService (UserCache)</strong>:
      <ul>
        <li><strong>分散キャッシュ (Granular Caching)</strong>: リスト単位でキャッシュし、100KB制限を回避。</li>
        <li><strong>部分更新</strong>: 移動に関与したリストのみキャッシュを破棄し、高速化。</li>
      </ul>
    </li>
    <li><strong>堅牢性 (Robustness)</strong>:
      <ul>
        <li><strong>Rate Limiting対策</strong>: API連続コール時のエラーを防ぐスロットリング実装。</li>
        <li><strong>Null Safety</strong>: <code>Invalid Value</code> エラーを防ぐ防御的プログラミング。</li>
      </ul>
    </li>
  </ul>

  <h3>フロントエンド</h3>
  <ul>
    <li><strong>Stack</strong>: HTML5, Vanilla JS, Bootstrap 5.</li>
    <li><strong>UI/UX</strong>: SPA風の画面遷移、BootstrapコンポーネントによるモダンなUI。</li>
    <li><strong>Error Handling</strong>: サーバーエラーの詳細を解析し、ユーザーフレンドリーなアラートを表示。</li>
  </ul>

  <h2>📦 セットアップ手順</h2>

  <h3>1. プロジェクト設定</h3>
  <ol>
    <li><a href="https://script.google.com/" target="_blank">Google Apps Script</a> で新規プロジェクトを作成。</li>
    <li><code>Code.gs</code>, <code>index.html</code>, <code>README.html</code> を作成しコードを貼り付け。</li>
  </ol>

  <h3>2. APIの有効化</h3>
  <p>エディタ左側の「サービス +」から <strong>Tasks API (v1)</strong> を追加。</p>

  <h3>3. マニフェスト (appsscript.json)</h3>
  <p>プロジェクト設定からマニフェストファイルを表示し、<code>oauthScopes</code> を設定。</p>
  <pre><code>"oauthScopes": [
  "https://www.googleapis.com/auth/tasks",
  "https://www.googleapis.com/auth/script.webapp.deploy"
]</code></pre>

  <h3>4. 承認とデプロイ</h3>
  <ol>
    <li><code>getTaskLists</code> 関数を手動実行して権限を承認。</li>
    <li>「デプロイ」&gt;「新しいデプロイ」からウェブアプリとして公開。</li>
  </ol>

  <div class="alert alert-info mt-4">
    <i class="bi bi-info-circle-fill"></i> <strong>Note:</strong>
    ブラウザの拡張機能（AdBlock等）がコンソールエラーを出すことがありますが、アプリの動作には影響ありません。
  </div>

</div>
</body>
</html>